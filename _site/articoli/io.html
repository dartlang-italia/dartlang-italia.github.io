<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dartlang Italia</title>
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css"> 
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31520550-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<div class="navbar navbar-fixed-top navbar-inverse">
    <div class="navbar-inner ">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </a>
            <div class="nav-collapse">
                <ul class="nav">
                    <li class="active"><a href="/">Dart Developers Italia</a></li>
                    <li><a href="/doc.html">Panoramica del linguaggio</a></li>
                    <li><a href="/articoli.html">Articoli e tutorial</a></li>
                    <li><a href="/risorse.html">Risorse esterne</a></li>
                </ul>
                <ul class="nav pull-right">
                    <li><a href="/news.html">Archivio News</a></li>
                    <li><a href="/lab.html">Dart Developers Italia Lab</a></li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Contatti<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://plus.google.com/b/102709061618541057184/102709061618541057184/posts"><i class="icon-google-plus icon-fixed-width"></i> Google+</a></li>
                            <li><a href="https://www.facebook.com/DartlangItalia"><i class="icon-twitter icon-fixed-width"></i> Twitter</a></li>
                            <li><a href="https://www.facebook.com/DartlangItalia"><i class="icon-facebook icon-fixed-width "></i> Facebook</a></li>
                            <li><a href="mailto:&#100;&#097;&#114;&#116;&#108;&#097;&#110;&#103;&#046;&#105;&#116;&#097;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;"><i class="icon-envelope-alt icon-fixed-width"></i> Email</a></li>
                            <li class="divider"></li>
                            <li><a href="/staff.html">Lo staff</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div id="main">
<div class="container">

<h1>dart:io</h1>

<em>articolo originale: <a href="page.urloriginale">An Introduction to the dart:io Library</a> di Mads Ager</em> <br />
<em>traduzione di <a href="">Gianluca di Fonzo</a></em></p>


<p>La libreria dart:io fornisce l’API per utilizzare file, cartelle, processi, socket e connessioni HTTP. Solo le applicazioni da riga di comando possono usare dart:io - e non le web app.</p>

<p>In generale, la libreria dart:io implementa e supporta un’API asincrona. Metodi sincroni possono bloccare facilmente il loop dell’evento, rendendo difficile la realizzazione di applicazioni server scalabili. Quindi, la maggior parte delle operazioni ritorna risultati attraverso delle callback o mediante oggetti Future, una pattern comune nelle piattaforme server moderne come Node.js.</p>

<p>I pochi metodi sincroni nella libreria dart:io sono marcati chiaramente col suffisso Sync sul nome del metodo. I metodi sincroni non saranno discussi qui.</p>

<h2 id="file-e-cartelle">File e cartelle</h2>

<p>La libreria I/O permette alle applicazioni da riga di comando di leggere e scrivere file e navigare nelle cartelle. Ci sono due modi per leggere il contenuto di un file: tutto in una volta, o con uno stream.
Leggere il file tutto in una volta richiede memoria a sufficienza per memorizzare tutto il contenuto del file. Se il file è molto grande o lo si vuole elaborare durante la lettura, allora si dovrebbe utilizzare un <code>InputStream</code>, come descritto in <em>Stream di un file</em>.</p>

<h3 id="lettura-di-un-file-di-testo">Lettura di un file di testo</h3>

<p>Quando si legge un file di testo, si può leggerne l’intero contenuto con <code>readAsText()</code>.
Quando le singole linee sono importanti, si può usare <code>readAsLines()</code>.
In entrambi i casi, viene restituito un oggetto <em>Future</em> che fornisce il contenuto del file come una o più stringhe.</p>

<pre><code>import 'dart:io';

main() {
	var config = new File('config.txt');

	// Inserisce l'intero file in una singola stringa
	config.readAsText(Encoding.UTF_8).then((String contenuti) {
		print("L'intero file è lungo ${contentuti.length} caratteri");
	});

	// Inserisce ogni linea del file in stringhe dedicate
	config.readAsLines(Encoding.UTF_8).then((List&lt;String&gt; linee) {
		print("L'intero file è composto da${lines.length} linee");
	});
}
</code></pre>

<h3 id="lettura-di-un-file-binario">Lettura di un file binario</h3>

<p>Il seguente codice legge un intero file binario e lo inserisce in una lista di interi.
La chiamata a <code>readAsBytes()</code> restituisce un Future, che fornisce il risultato quando è disponibile.</p>

<pre><code>import 'dart:io';

main() {
	var config = new File('config.txt');

	config.readAsBytes().then((List&lt;int&gt; contenuti) {
		print("L'intero file è lungo ${contents.length} byte");
	});
}
</code></pre>

<h3 id="gestione-degli-errori">Gestione degli errori</h3>

<p>Gli errori vengono lanciati come eccezioni se non viene registrato un handler esplicito.
Se si vuole catturare un errore, si può registrare un gestore handleException con l’oggetto Future.</p>

<pre><code>main() {
	var config = new File('config.txt');
	Future readFile = config.readAsText();
	readFile.handleException((e) {
		print(e);
		// ...Qui vanno altre gestioni dell'errore...
		return true; // Abbiamo gestito l'eccezione; non serve propagarla.
	});
	readFile.then((text) =&gt; print(text));
}
</code></pre>

<h3 id="stream-di-un-file">Stream di un file</h3>

<p>Per leggere un file un po’ alla volta si utilizza un <code>InputStream</code>. La funzione di callback <code>onData</code>
viene eseguita quando i dati sono pronti per essere letti.
Quando l’InputStream ha terminato la lettura, allora viene eseguita la callback <code>onClosed</code>.</p>

<pre><code>import 'dart:io';

main() {
	var config = new File('config.txt');
	var inputStream = config.openInputStream();

	inputStream.onError = (e) =&gt; print(e);
	inputStream.onClosed = () =&gt; print('file chiuso');
	inputStream.onData = () {
		List&lt;int&gt; bytes = inputStream.read();
		print('Letti ${bytes.length} byte dallo stream');
	};
}
</code></pre>

<p>Per decodificare un <code>InputStream</code> da byte a caratteri, bisogna incapsulare
l’InputStream con un <code>StringInputStream</code>. Si possono leggere le stringhe sia
quanto i dati diventano disponibili sia una linea alla volta.</p>

<h3 id="scrittura-di-un-file">Scrittura di un file</h3>
<p>Per scrivere dati in un file si utilizza un <code>OutputStream</code>.
Per farlo, bisogna aprire il file in scrittura con <code>openOutputStream()</code> e
dichiarare una modalità di scrittura.
Aprendo il file in modalità <code>FileMode.WRITE</code> si sovrascrivono completamente i
dati presenti nel file, aprendolo con <code>FileMode.APPEND</code> i dati vengono aggiunti alla fine del file.</p>

<pre><code>import 'dart:io';

main() {
	var logFile = new File('log.txt');
	var out = logFile.openOutputStream(FileMode.WRITE);
	out.writeString('FILE APERTO ${new Date.now()}');
	out.close();
}
</code></pre>

<p>Per scrivere dati binari, si usa <code>write(List&lt;int&gt; buffer)</code>.</p>

<h3 id="elencare-i-file-di-una-cartella">Elencare i file di una cartella</h3>
<p>Trovare tutti i file e sottocartelle di una cartella è un’operazione asincrona.
Il metodo <code>list()</code> ritorna un <code>DirectoryLister</code>, sul quale si possono registrare
i callback handler che devono essere notificati quando si incontra un file (usando <code>onFile</code>)
o quando si incontra una cartella (usando <code>onDir</code>).</p>

<pre><code>import 'dart:io';

main() {
	var dir = new Directory('/tmp');

	DirectoryLister lister = dir.list(recursive:true); // Returns immediately.
	lister.onError = (e) =&gt; print(e);
	lister.onFile = (String name) =&gt; print('Found file $name');
	lister.onDir = (String name) =&gt; print('Found dir $name');
}
</code></pre>

<h3 id="altre-funzionalit-comuni">Altre funzionalità comuni</h3>

<p>Le classi File e Directory contengono altre funzionalità, tra cui:</p>

<ul>
  <li>
    <p>Creare un file o una cartella: <code>create()</code> in File e Directory;</p>
  </li>
  <li>
    <p>Cancellare un file o una cartella: <code>delete()</code> in File e Directory;</p>
  </li>
  <li>
    <p>Ottenere la lunghezza di un file: <code>length()</code> in File;</p>
  </li>
  <li>
    <p>Ottenere l’accesso casuale a un file: <code>open()</code> in File.</p>
  </li>
</ul>

<p>La lista intere dei metodi è presente nella documentazione per File, Directory e DirectoryLister.
Si invinta a consultare anche la documentazione per InputStream, StringInputStream e OutputStream</p>

<p>In aggiunta all’API discusse in questa sezione, la libreria <code>dart:io</code> fornisce API per processi, socket e web socket.</p>

<p>La librerio <code>dart:io</code> fornisce le classi che le applicazioni da riga di comando
possono utilizzare per accedere alle risorse e ai server HTTP.</p>

<h2 id="http-server">HTTP server</h2>

<p>La classe <code>HttpServer</code> fornisce la funzionalità a basso livello per costruire
dei web server. Si possono associare request handler, inmpostare gli header,
trasmettere dati, e altro.</p>

<p>Dato che Dart non è multithread e ha un event loop, la progettazione delle API di <code>HttpServer</code>
favoriscono le callback per la gestione degli eventi.</p>

<p>Il seguente web server di esempio può restituire solo semplice testo d’informazione.
Questo server ascolta sulla porta 8888 dell’indirizzo 127.0.0.1 (localhost),
rispondendo alle richieste per il path <code>/languages/dart</code>.
Tutte le altre richieste sono gestite dal request handler di default, che ritorna
il codice di risposta 404 (not found).</p>

<pre><code>import 'dart:io';

main() {
	dartHandler(HttpRequest request, HttpResponse response) {
		print('Nuova richiesta');
		response.outputStream.writeString('Dart è opzionalmente tipizzato');
		response.outputStream.close();
	};

	var httpServer = new HttpServer();
	httpServer.addRequestHandler(
		(req) =&gt; req.path == '/languages/dart',
		dartHandler);

	httpServer.listen('127.0.0.1', 8888);
}
</code></pre>

<h3 id="client-http">Client HTTP</h3>

<p>La classe <code>HttpClient</code> aiuta a connettere alle risorse HTTP dall’applicazione Dart
lato server. Si possono impostare gli header, usare metodi HTTP, e leggere e scrivere dati.</p>

<p>Nota: La classe <code>HttpClient</code> non funziona nelle applicazioni browser-based.
Per programmare applicazioni browser-based, usa la classe <code>HttpRequest</code>.</p>

<p>L’API di <code>HttpClient</code>, come quella di <code>HttpServer</code>, è callback-oriented. Il flusso generale degli eventi è come segue:</p>

<ol>
  <li>
    <p>Crea un nuovo <code>HttpClient</code>.</p>
  </li>
  <li>
    <p>Ottiene l’URL.</p>
  </li>
  <li>
    <p>Definisce la callback <code>onResponse()</code> sulla <code>HttpClientconnection</code>.</p>
  </li>
  <li>
    <p>Definisce la callback <code>onData()</code> sull’input stream.</p>
  </li>
  <li>
    <p>Definisce la callback <code>onClosed()</code> sulla <code>HttpClientConnection</code>.</p>
  </li>
  <li>
    <p>Legge dati quando sono disponibili.</p>
  </li>
  <li>
    <p>Chiude <code>HttpClient</code> quando non vuoi più creare delle connessioni che lo utilizzano.</p>

    <pre><code> import 'dart:io';
 import 'dart:uri';

 main() {
     var httpClient = new HttpClient();
     var conn = httpClient.getUrl(new Uri('http://127.0.0.1:8888/languages/dart'));
     conn.onResponse = (HttpClientResponse resp) {
         var input = resp.inputStream;
         input.onData = () {
             var data = input.read();
             var text = new String.fromCharCodes(data);
             print(text);
         };
         input.onClosed = () =&gt; httpClient.shutdown();
     };
 }
</code></pre>
  </li>
</ol>

</div>
</div> <!-- end #main -->
<div id="separatore_footer"></div>
<footer>
    <div class="container">
    <div class="row">
        <div class="span6">
            <p><strong>Dartlang Italia</strong> &egrave; una community di supporto <strong>non ufficiale</strong> e senza scopi di lucro, in nessun modo collegata al progetto <a href="http://dartlang.org">Google Dart</a>.</p>
            <p>I contenuti del sito <a href="/">dartlang-italia.it</a> sono pubblicati dietro licenza <a href="http://creativecommons.org/licenses/by/3.0/deed.it">CC BY 3.0</a>, il codice di questo sito e gli esempi di codice Dart sono distribuiti dietro licenza <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>.</p>
        </div>


        <div class="span6">
            <p>Questo sito &egrave; stato generato con <a href="http://jekyllrb.com">Jekyll</a> ed utilizza il framework <a href="twitter.github.com/bootstrap">Bootstrap</a>. Questo sito &egrave; <strong>open source</strong>, il codice sorgente &egrave; disponibile su <a href="https://github.com/dartlang-italia/dartlang-italia.github.io">Github</a>.</p>
            <p>Le segnalazioni su incorrettezze o bug del sito possono essere inoltrate su <a href="https://github.com/dartlang-italia/dartlang-italia.github.io/issues">GitHub Issues</a>.</p>
            <p>Vuoi diventare uno dei nostri <a href="/staff.html">collaboratori?</a> Mandaci <a href="mailto:&#100;&#097;&#114;&#116;&#108;&#097;&#110;&#103;&#046;&#105;&#116;&#097;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">un'email</a> o contattaci attraverso i <a href="/">social network</a>.</p>
        <p>2012-2013, <a href="http://www.claudiodangelis.com/about">Claudio d'Angelis</a>, <strong>Dartlang Italia</strong></p>
        </div>
    </div>

</div>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
